{"version":3,"sources":["webpack:///./routes/editor/index.tsx","webpack:///./components/list/index.tsx","webpack:///./hooks/media_query.ts","webpack:///./utils/redirect.ts","webpack:///./components/icon.tsx"],"names":["Editor","file","fs","useContext","FileSystemContext","zoom","setZoom","useState","map","setMap","editing","all","h","Grid","List","onZoomChange","class","type","checked","onInput","e","currentTarget","style","name","onClick","undo","redo","to","prevent","event","preventDefault","observer","MutationObserver","mutations","mutation","input","addedNodes","HTMLElement","querySelector","focus","active","useRef","container","phone","query","matches","setMatches","useEffect","change","matchList","window","matchMedia","addEventListener","removeEventListener","useMediaQuery","tree","observe","current","childList","subtree","disconnect","previousLevel","item","key","value","Array","isArray","children","length","index","findIndex","nested","indexOf","returns","i","filter","splice","array","lines","width","measure","text","rows","onFocus","onBlur","tabIndex","onKeyDown","ctrlKey","slice","selectionStart","selectionEnd","shiftKey","n","a","concat","placeholder","add","some","top","includes","ref","onKeyUp","Math","floor","random","props","onMouseDown","role","Redirect","Component","componentWillMount","route","this","render","Icon","color"],"mappings":"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","file":"route-editor.chunk.0e340.esm.js","sourcesContent":["import {h, FunctionComponent, Fragment} from \"preact\";\r\nimport {useContext, useState} from \"preact/hooks\";\r\nimport FileSystemContext from \"components/filesystem/context\";\r\nimport List from \"components/list\";\r\nimport Grid from \"components/grid\";\r\nimport {Tree} from \"utils/tree\";\r\nimport Icon from \"components/icon\";\r\nimport Redirect from \"utils/redirect\";\r\nimport \"./style.scss\";\r\n\r\nconst Editor: FunctionComponent<Editor.Props> = ({file}) => {\r\n\tconst fs = useContext(FileSystemContext);\r\n\tconst [zoom, setZoom] = useState(1);\r\n\tconst [map, setMap] = useState(true);\r\n\tconst editing = +file;\r\n\tif (!(editing in fs.all)) {\r\n\t\treturn <Redirect to=\"/\" />;\r\n\t}\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{h(map ? Grid : List, {editing, onZoomChange: setZoom, zoom})}\r\n\t\t\t<div class=\"vertical toolbar\">\r\n\t\t\t\t<button>\r\n\t\t\t\t\t<label>\r\n\t\t\t\t\t\t<input type=\"checkbox\" checked={map} onInput={e => setMap(e.currentTarget.checked)} />\r\n\t\t\t\t\t\t<Icon style=\"round\" name=\"\" />\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</button>\r\n\t\t\t\t<button\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tif (zoom > 0.25) {\r\n\t\t\t\t\t\t\tsetZoom(zoom - 0.25);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon name=\"zoom_out\" style=\"outlined\" />\r\n\t\t\t\t</button>\r\n\t\t\t\t<button\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tif (zoom <= 2.5) {\r\n\t\t\t\t\t\t\tsetZoom(zoom + 0.25);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon name=\"zoom_in\" style=\"outlined\" />\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"horizontal toolbar\">\r\n\t\t\t\t<button onClick={() => fs.undo()}>\r\n\t\t\t\t\t<Icon name=\"undo\" />\r\n\t\t\t\t</button>\r\n\t\t\t\t<button onClick={() => fs.redo()}>\r\n\t\t\t\t\t<Icon name=\"redo\" />\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n\r\n};\r\n\r\ndeclare namespace Editor {\r\n\texport interface Props {\r\n\t\tfile: `${number}`;\r\n\t}\r\n\r\n\texport interface State {\r\n\t\tundo: Tree.Data[];\r\n\t\tredo: Tree.Data[];\r\n\t\tzoom: number;\r\n\t\tview: string;\r\n\t}\r\n}\r\n\r\nexport default Editor;\r\n","/**\r\n * @author Tomáš Wróbel\r\n * @license MIT\r\n *\r\n * I am the component providing list view.\r\n * A list is fast to view and edit\r\n * but has nothing to do with maps\r\n */\r\nimport {h, FunctionComponent} from \"preact\";\r\nimport {useContext, useEffect, useRef} from \"preact/hooks\";\r\nimport FileSystemContext from \"../filesystem/context\";\r\nimport Icon from \"../icon\";\r\nimport \"./style.scss\";\r\nimport measure from \"utils/wrapText\";\r\nimport useMediaQuery from \"hooks/media_query\";\r\n\r\nconst focus: MutationCallback = (mutations) => {\r\n\tfor (const mutation of mutations) {\r\n\t\tconst input = mutation.addedNodes[0];\r\n\r\n\t\tif (input instanceof HTMLElement) {\r\n\t\t\tinput.querySelector(\"textarea\")?.focus?.();\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction prevent(event: Event) {\r\n\tevent.preventDefault();\r\n}\r\n\r\nconst observer = new MutationObserver(focus);\r\n\r\nconst List: FunctionComponent<List.Props> = ({editing, zoom = 1}) => {\r\n\tconst active = useRef<List.Item | null>(null);\r\n\tconst fs = useContext(FileSystemContext);\r\n\tconst container = useRef<HTMLDivElement>(null);\r\n\tconst phone = useMediaQuery(\"(max-width: 640px)\");\r\n\tconst tree = fs.all[editing];\r\n\r\n\tuseEffect(() => {\r\n\t\tobserver.observe(container.current!, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t});\r\n\r\n\t\treturn () => observer.disconnect();\r\n\t});\r\n\r\n\tconst previousLevel = (item: List.Item) => fs.change(\r\n\t\tediting,\r\n\t\t(key, value: List.Item) => {\r\n\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\tif (Array.isArray(value.children) && value.children.length && value.type !== \"heading\") {\r\n\t\t\t\t\tconst index = value.children.findIndex(nested => nested.children.indexOf(item) > -1) + 1;\r\n\t\t\t\t\tif (index) {\r\n\t\t\t\t\t\tconst returns = {\r\n\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\tchildren: value.children.map((nested, i) => {\r\n\t\t\t\t\t\t\t\tif (i === index - 1) {\r\n\t\t\t\t\t\t\t\t\treturn {...nested, children: nested.children.filter(i => i !== item)};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn nested;\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\treturns.children.splice(index, 0, item);\r\n\t\t\t\t\t\treturn returns;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tconst map = (item: List.Item, index: number, array: List.Item[]) => {\r\n\t\tconst {lines, width} = measure(item.text || \"New item...\", phone ? 17 : 20);\r\n\t\treturn (\r\n\t\t\t<li class={item.type}>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tstyle={{width}}\r\n\t\t\t\t\trows={lines.length}\r\n\t\t\t\t\tvalue={item.text}\r\n\t\t\t\t\tonFocus={() => active.current = item}\r\n\t\t\t\t\tonBlur={() => active.current = null}\r\n\t\t\t\t\ttabIndex={-1}\r\n\t\t\t\t\tonInput={e => fs.change(\r\n\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\tif (value === item) {\r\n\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\ttext: e.currentTarget.value,\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)}\r\n\t\t\t\t\tonKeyDown={e => {\r\n\t\t\t\t\t\tif (e.key === \"Enter\") {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\tif (!item.text) {\r\n\t\t\t\t\t\t\t\tpreviousLevel(item);\r\n\t\t\t\t\t\t\t} else if (e.ctrlKey) {\r\n\t\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\t\tif (value === item) {\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext:\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t`${item.text.slice(0, e.currentTarget.selectionStart)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\\n${item.text.slice(e.currentTarget.selectionEnd)}`,\r\n\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\te.currentTarget.selectionStart === e.currentTarget.selectionEnd &&\r\n\t\t\t\t\t\t\t\te.currentTarget.selectionStart === item.text.length\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tif (tree.children === array || item.children.length || e.shiftKey) {\r\n\t\t\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (value === item) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (item.type === \"note\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...item.children,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"note\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst returns = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...item.children\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturns.children.splice(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// The index of the first note.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If not present, insert the new body at the last position \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(item.children.findIndex(n => n.type === \"note\") + 1) || item.children.length,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"body\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn returns;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (value.children === array) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst returns = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [...array],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturns.children.splice(index + 1, 0, {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: e.shiftKey || item.type === \"note\" ? \"note\" : \"body\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn returns;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\te.currentTarget.selectionEnd = e.currentTarget.selectionStart = item.text.length;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (e.key === \"Backspace\" && !item.text) {\r\n\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\tif (value.children === array) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\t\t\t\tchildren: array.filter(a => a !== item),\r\n\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (e.key === \"Tab\" && index && array !== tree.children) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\tif (!e.shiftKey) {\r\n\t\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\t\tif (value.children === array) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst returns = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [...array]\r\n\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\treturns.children.splice(index - 1, 2, {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...array[index - 1],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: array[index - 1].children.concat(item),\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn returns;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpreviousLevel(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tplaceholder=\"New item...\"\r\n\t\t\t\t/>\r\n\t\t\t\t{!item.children.length || <ul class={item.type}>{item.children.map(map)}</ul>}\r\n\t\t\t</li>\r\n\t\t);\r\n\t};\r\n\r\n\tconst add = (type: List.Item[\"type\"], index: number) => (e?: Event) => {\r\n\t\te?.preventDefault();\r\n\t\tconst isInside = (\r\n\t\t\tactive.current &&\r\n\t\t\ttree.children[index] === active.current ||\r\n\t\t\ttree.children[index].children.some(function some(i): boolean {\r\n\t\t\t\treturn i === active.current || i.children.some(some);\r\n\t\t\t})\r\n\t\t);\r\n\t\tif (isInside) {\r\n\t\t\tvar item = active.current!;\r\n\t\t} else {\r\n\t\t\tfor (\r\n\t\t\t\tvar item = tree.children[index];\r\n\t\t\t\titem.children.length;\r\n\t\t\t\titem = item.children[item.children.length - 1]\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst top = tree.children.includes(item) || !!item.children.length;\r\n\t\tfs.change(\r\n\t\t\tediting,\r\n\t\t\t(key, value) => {\r\n\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\tif (value === item && top) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\tchildren: [...item.children, {\r\n\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else if (!top && value.children?.includes(item)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t...value.children,\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div style={{zoom: `${zoom * 100}%`}} ref={container}>\r\n\t\t\t<h1>\r\n\t\t\t\t<input\r\n\t\t\t\t\tvalue={tree.text}\r\n\t\t\t\t\tonInput={e => fs.change(editing, (key, value) => {\r\n\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\tif (value === fs.all[editing]) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\ttext: e.currentTarget.value\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})}\r\n\t\t\t\t\tonKeyUp={e => e.key === \"Enter\" && fs.change(editing, (key, value) => {\r\n\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\tif (value === fs.all[editing]) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\tchildren: [...value.children, {\r\n\t\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\t\t\t\t\ttype: `color-${Math.floor(Math.random() * 36) + 1}`\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})}\r\n\t\t\t\t/>\r\n\t\t\t</h1>\r\n\t\t\t{fs.all[editing].children.map(map).map((tree, i) => (\r\n\t\t\t\t<ul class={`list ${tree.props.class}`} key={i}>\r\n\t\t\t\t\t{tree}\r\n\t\t\t\t\t<li class=\"add\" onMouseDown={prevent} onClick={add(\"body\", i)}>\r\n\t\t\t\t\t\t<Icon name=\"grid_view\" style=\"round\" role=\"button\" />\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li />\r\n\t\t\t\t\t<li class=\"add\" onMouseDown={prevent} onClick={add(\"note\", i)}>\r\n\t\t\t\t\t\t<Icon name=\"description\" style=\"round\" role=\"button\" />\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t))}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\ndeclare namespace List {\r\n\texport interface Props {\r\n\t\tzoom?: number;\r\n\t\tediting: number;\r\n\t\tonZoomChange?: (zoom: number) => void;\r\n\t}\r\n\r\n\texport interface Item {\r\n\t\ttext: string;\r\n\t\ttype: \"note\" | `color-${number}` | \"body\" | \"heading\";\r\n\t\tchildren: Item[];\r\n\t\tdescription?: string;\r\n\t\tlink?: string;\r\n\t}\r\n}\r\n\r\nexport default List;","import {useState, useEffect} from \"preact/hooks\";\r\n\r\nexport default function useMediaQuery(query: string) {\r\n\tconst [matches, setMatches] = useState(false);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst matchList = window.matchMedia(query);\r\n\t\tfunction change(e: MediaQueryListEvent) {\r\n\t\t\tsetMatches(e.matches);\r\n\t\t}\r\n\t\tmatchList.addEventListener(\"change\", change);\r\n\r\n\t\treturn () => {\r\n\t\t\tmatchList.removeEventListener(\"change\", change);\r\n\t\t}\r\n\t}, [query])\r\n\r\n\treturn matches;\r\n}","import {Component} from \"preact\";\r\nimport {route} from \"preact-router\";\r\n\r\nclass Redirect extends Component<Redirect.Props> {\r\n\tcomponentWillMount() {\r\n\t\troute(this.props.to, true);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\ndeclare namespace Redirect {\r\n\texport interface Props {\r\n\t\tto: string;\r\n\t}\r\n}\r\n\r\nexport default Redirect;","import {Component, h} from \"preact\";\r\n\r\nclass Icon extends Component<Icon.Props> {\r\n\trender({name, color, style = \"\", ...props}: Icon.Props) {\r\n\t\treturn (\r\n\t\t\t<span style={{color}} class={\"material-icons\" + (style && \"-\" + style)} {...props}>\r\n\t\t\t\t{name}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nnamespace Icon {\r\n\texport interface Props extends h.JSX.HTMLAttributes<HTMLSpanElement> {\r\n\t\tname: string;\r\n\t\tcolor?: string;\r\n\t\tstyle?: \"\" | \"round\" | \"outlined\";\r\n\t}\r\n}\r\n\r\nexport default Icon;\r\n"],"sourceRoot":""}