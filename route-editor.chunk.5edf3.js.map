{"version":3,"sources":["webpack:///./routes/editor/index.tsx","webpack:///./components/list/index.tsx","webpack:///./hooks/media_query.ts","webpack:///./utils/redirect.ts","webpack:///./components/icon.tsx"],"names":["Editor","file","fs","useContext","FileSystemContext","useState","zoom","setZoom","map","setMap","editing","all","h","Grid","List","onZoomChange","class","type","checked","onInput","e","currentTarget","style","name","onClick","undo","redo","to","prevent","event","preventDefault","observer","MutationObserver","mutations","input","addedNodes","HTMLElement","querySelector","focus","query","matches","setMatches","active","useRef","container","phone","useEffect","change","matchList","window","matchMedia","addEventListener","removeEventListener","tree","observe","current","childList","subtree","disconnect","previousLevel","item","key","value","Array","isArray","children","length","index","findIndex","nested","indexOf","returns","i","filter","splice","add","some","top","includes","text","ref","onKeyUp","Math","floor","random","array","measure","lines","width","rows","onFocus","onBlur","tabIndex","onKeyDown","ctrlKey","slice","selectionStart","selectionEnd","shiftKey","n","a","concat","placeholder","props","onMouseDown","role","Redirect","route","this","Component","Icon","color"],"mappings":"kqCAyEeA,UA/DiC,SAAC,GAAW,IAAVC,EAAU,EAAVA,KAC3CC,EAAKC,YAAWC,KACtB,IAAwBC,YAAS,GAAjC,GAAOC,EAAP,KAAaC,EAAb,KACA,IAAsBF,aAAS,GAA/B,GAAOG,EAAP,KAAYC,EAAZ,KACMC,GAAWT,EACjB,OAAMS,KAAWR,EAAGS,IAInB,mBACEC,YAAEJ,EAAMK,IAAOC,IAAM,CAACJ,UAASK,aAAcR,EAASD,SACvD,mBAAKU,MAAM,oBACV,0BACC,yBACC,qBAAOC,KAAK,WAAWC,QAASV,EAAKW,QAAS,SAAAC,GAAC,OAAIX,EAAOW,EAAEC,cAAcH,YAC1E,YAAC,IAAD,CAAMI,MAAM,QAAQC,KAAK,OAG3B,sBACCC,QAAS,WACJlB,EAAO,KACVC,EAAQD,EAAO,OAIjB,YAAC,IAAD,CAAMiB,KAAK,WAAWD,MAAM,cAE7B,sBACCE,QAAS,WACJlB,GAAQ,KACXC,EAAQD,EAAO,OAIjB,YAAC,IAAD,CAAMiB,KAAK,UAAUD,MAAM,eAG7B,mBAAKN,MAAM,sBACV,sBAAQQ,QAAS,kBAAMtB,EAAGuB,SACzB,YAAC,IAAD,CAAMF,KAAK,UAEZ,sBAAQC,QAAS,kBAAMtB,EAAGwB,SACzB,YAAC,IAAD,CAAMH,KAAK,YApCP,YAAC,IAAD,CAAUI,GAAG,Q,+8ECUtB,SAASC,EAAQC,GAChBA,EAAMC,iB,gEAGDC,EAAW,IAAIC,kBAdW,SAACC,GAAc,Q,goBAAA,CACvBA,GADuB,IAC9C,2BAAkC,KAGC,IAF5BC,EAD2B,QACVC,WAAW,GAElC,GAAID,aAAiBE,YACpB,UAAAF,EAAMG,cAAc,mBAApB,mBAAiCC,aAAjC,kBAL4C,kCAqVhCxB,IArU6B,SAAC,GAAwB,IC9B/ByB,EACrC,EAAOC,EAASC,ED6B6B/B,EAAuB,EAAvBA,QAAuB,IAAdJ,YAAc,MAAP,EAAO,EAC9DoC,EAASC,YAAyB,MAClCzC,EAAKC,YAAWC,KAChBwC,EAAYD,YAAuB,MACnCE,GClC+BN,EDkCT,qBCjC5B,IAA8BlC,aAAS,GAAvC,GAAOmC,EAAP,KAAgBC,EAAhB,KAEAK,aAAU,WAET,SAASC,EAAO3B,GACfqB,EAAWrB,EAAEoB,SAFd,IAAMQ,EAAYC,OAAOC,WAAWX,GAMpC,OAFAS,EAAUG,iBAAiB,SAAUJ,GAE9B,WACNC,EAAUI,oBAAoB,SAAUL,MAEvC,CAACR,IAEGC,GDoBDa,EAAOnD,EAAGS,IAAID,GAEpBoC,aAAU,WAMT,OALAf,EAASuB,QAAQV,EAAUW,QAAU,CACpCC,WAAW,EACXC,SAAS,IAGH,kBAAM1B,EAAS2B,iBAGvB,IAAMC,EAAgB,SAACC,GAAD,OAAqB1D,EAAG6C,OAC7CrC,GACA,SAACmD,EAAKC,GACL,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EAAa,CACtE,GAAIE,MAAMC,QAAQF,EAAMG,WAAaH,EAAMG,SAASC,QAAyB,YAAfJ,EAAM7C,KAAoB,CACvF,IAAMkD,EAAQL,EAAMG,SAASG,WAAU,SAAAC,GAAM,OAAIA,EAAOJ,SAASK,QAAQV,IAAS,KAAK,EACvF,GAAIO,EAAO,CACV,IAAMI,EAAU,EAAH,KACTT,GADS,IAEZG,SAAUH,EAAMG,SAASzD,KAAI,SAAC6D,EAAQG,GACrC,OAAIA,IAAML,EAAQ,EACjB,OAAWE,GAAX,IAAmBJ,SAAUI,EAAOJ,SAASQ,QAAO,SAAAD,GAAC,OAAIA,IAAMZ,OAEzDS,OAIT,OADAE,EAAQN,SAASS,OAAOP,EAAO,EAAGP,GAC3BW,GAGT,OAAOT,OA6KJa,EAAM,SAAC1D,EAAyBkD,GAA1B,OAA4C,SAAC/C,GASxD,GARAA,WAAGU,iBAEFY,EAAOa,SACPF,EAAKY,SAASE,KAAWzB,EAAOa,SAChCF,EAAKY,SAASE,GAAOF,SAASW,MAAK,SAASA,EAAKJ,GAChD,OAAOA,IAAM9B,EAAOa,SAAWiB,EAAEP,SAASW,KAAKA,MAIhD,IAAIhB,EAAOlB,EAAOa,aAElB,IACKK,EAAOP,EAAKY,SAASE,GACzBP,EAAKK,SAASC,OACdN,EAAOA,EAAKK,SAASL,EAAKK,SAASC,OAAS,IAG9C,IAAMW,EAAMxB,EAAKY,SAASa,SAASlB,MAAWA,EAAKK,SAASC,OAC5DhE,EAAG6C,OACFrC,GACA,SAACmD,EAAKC,GACkE,MAAvE,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EACzD,OAAIC,IAAUF,GAAQiB,EACrB,OACIjB,GADJ,IAECK,SAAU,GAAF,SAAML,EAAKK,UAAX,CAAqB,CAC5Bc,KAAM,GACN9D,OACAgD,SAAU,SAGDY,GAAD,UAAQf,EAAMG,gBAAd,OAAQ,EAAgBa,SAASlB,GAC3C,OACIE,GADJ,IAECG,SAAU,GAAF,SACJH,EAAMG,UADF,CAEP,CACCc,KAAM,GACN9D,OACAgD,SAAU,QAKPH,OAMX,OACC,mBAAKxC,MAAO,CAAChB,KAAM,GAAF,OAAY,IAAPA,EAAL,MAAqB0E,IAAKpC,GAC1C,sBACC,qBACCkB,MAAOT,EAAK0B,KACZ5D,QAAS,SAAAC,GAAC,OAAIlB,EAAG6C,OAAOrC,GAAS,SAACmD,EAAKC,GACtC,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EACzD,OAAIC,IAAU5D,EAAGS,IAAID,GACpB,OACIoD,GADJ,IAECiB,KAAM3D,EAAEC,cAAcyC,QAGjBA,MAGTmB,QAAS,SAAA7D,GAAC,MAAc,UAAVA,EAAEyC,KAAmB3D,EAAG6C,OAAOrC,GAAS,SAACmD,EAAKC,GAC3D,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EACzD,OAAIC,IAAU5D,EAAGS,IAAID,GACpB,OACIoD,GADJ,IAECG,SAAU,GAAF,SAAMH,EAAMG,UAAZ,CAAsB,CAC7Bc,KAAM,GACNd,SAAU,GACVhD,KAAM,SAAF,OAAWiE,KAAKC,MAAsB,GAAhBD,KAAKE,UAAiB,QAI5CtB,SAKV5D,EAAGS,IAAID,GAASuD,SAASzD,KA5PhB,SAANA,EAAOoD,EAAiBO,EAAekB,GAC5C,MAAuBC,YAAQ1B,EAAKmB,MAAQ,cAAelC,EAAQ,GAAK,IAAjE0C,EAAP,EAAOA,MAAOC,EAAd,EAAcA,MACd,OACC,kBAAIxE,MAAO4C,EAAK3C,MACf,wBACCK,MAAO,CAACkE,SACRC,KAAMF,EAAMrB,OACZJ,MAAOF,EAAKmB,KACZW,QAAS,kBAAMhD,EAAOa,QAAUK,GAChC+B,OAAQ,kBAAMjD,EAAOa,QAAU,MAC/BqC,UAAW,EACXzE,QAAS,SAAAC,GAAC,OAAIlB,EAAG6C,OAChBrC,GACA,SAACmD,EAAKC,GACL,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EACzD,OAAIC,IAAUF,EACb,OACIA,GADJ,IAECmB,KAAM3D,EAAEC,cAAcyC,QAGjBA,MAIV+B,UAAW,SAAAzE,GACI,UAAVA,EAAEyC,MACLzC,EAAEU,iBACG8B,EAAKmB,KAEC3D,EAAE0E,QACZ5F,EAAG6C,OACFrC,GACA,SAACmD,EAAKC,GACL,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EACzD,OAAIC,IAAUF,EACb,OACIA,GADJ,IAECmB,KAAI,UACAnB,EAAKmB,KAAKgB,MAAM,EAAG3E,EAAEC,cAAc2E,gBADnC,aAEEpC,EAAKmB,KAAKgB,MAAM3E,EAAEC,cAAc4E,iBAGjCnC,KAKV1C,EAAEC,cAAc2E,iBAAmB5E,EAAEC,cAAc4E,cACnD7E,EAAEC,cAAc2E,iBAAmBpC,EAAKmB,KAAKb,OAG5ChE,EAAG6C,OACFrC,EAFE2C,EAAKY,WAAaoB,GAASzB,EAAKK,SAASC,QAAU9C,EAAE8E,SAGvD,SAACrC,EAAKC,GACL,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EAAa,CACtE,GAAIC,IAAUF,EAAM,CACnB,GAAkB,SAAdA,EAAK3C,KACR,cACI2C,GADJ,IAECK,SAAU,GAAF,SACJL,EAAKK,UADD,CAEP,CACCc,KAAM,GACNd,SAAU,GACVhD,KAAM,YAKV,IAAMsD,EAAU,EAAH,KACTX,GADS,IAEZK,SAAU,EACNL,EAAKK,YAcV,OAXAM,EAAQN,SAASS,OAGfd,EAAKK,SAASG,WAAU,SAAA+B,GAAC,MAAe,SAAXA,EAAElF,QAAmB,GAAM2C,EAAKK,SAASC,OACvE,EACA,CACCa,KAAM,GACNd,SAAU,GACVhD,KAAM,SAGDsD,EAGR,OAAOT,IAOT,SAACD,EAAKC,GACL,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EAAa,CACtE,GAAIC,EAAMG,WAAaoB,EAAO,CAC7B,IAAMd,EAAU,EAAH,KACTT,GADS,IAEZG,SAAU,EAAIoB,KAOf,OALAd,EAAQN,SAASS,OAAOP,EAAQ,EAAG,EAAG,CACrCY,KAAM,GACNd,SAAU,GACVhD,KAAMG,EAAE8E,UAA0B,SAAdtC,EAAK3C,KAAkB,OAAS,SAE9CsD,EAER,OAAOT,KAMX1C,EAAEC,cAAc4E,aAAe7E,EAAEC,cAAc2E,eAAiBpC,EAAKmB,KAAKb,OAxF1EP,EAAcC,IA2FF,cAAVxC,EAAEyC,KAAwBD,EAAKmB,MAClC7E,EAAG6C,OACFrC,GACA,SAACmD,EAAKC,GACL,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EACzD,OAAIC,EAAMG,WAAaoB,EACtB,OACIvB,GADJ,IAECG,SAAUoB,EAAMZ,QAAO,SAAA2B,GAAC,OAAIA,IAAMxC,OAG7BE,KAIG,QAAV1C,EAAEyC,KAAiBM,GAASkB,IAAUhC,EAAKY,WAC9C7C,EAAEU,iBACGV,EAAE8E,SAoBNvC,EAAcC,GAnBd1D,EAAG6C,OACFrC,GACA,SAACmD,EAAKC,GACL,GAAY,UAARD,GAA2B,WAARA,GAA4B,MAARA,GAAuB,MAARA,EAAa,CACtE,GAAIC,EAAMG,WAAaoB,EAAO,CAC7B,IAAMd,EAAU,EAAH,KACTT,GADS,IAEZG,SAAU,EAAIoB,KAMf,OAJAd,EAAQN,SAASS,OAAOP,EAAQ,EAAG,EAAnC,OACIkB,EAAMlB,EAAQ,IADlB,IAECF,SAAUoB,EAAMlB,EAAQ,GAAGF,SAASoC,OAAOzC,MAErCW,EAER,OAAOT,QAQbwC,YAAY,iBAEX1C,EAAKK,SAASC,QAAU,kBAAIlD,MAAO4C,EAAK3C,MAAO2C,EAAKK,SAASzD,IAAIA,QAyFjCA,KAAI,SAAC6C,EAAMmB,GAAP,OACtC,kBAAIxD,MAAK,eAAUqC,EAAKkD,MAAMvF,OAAS6C,IAAKW,GAC1CnB,EACD,kBAAIrC,MAAM,MAAMwF,YAAa5E,EAASJ,QAASmD,EAAI,OAAQH,IAC1D,YAAC,IAAD,CAAMjD,KAAK,YAAYD,MAAM,QAAQmF,KAAK,YAE3C,uBACA,kBAAIzF,MAAM,MAAMwF,YAAa5E,EAASJ,QAASmD,EAAI,OAAQH,IAC1D,YAAC,IAAD,CAAMjD,KAAK,cAAcD,MAAM,QAAQmF,KAAK,mB,y3CE1U5CC,E,oZACL,WACCC,gBAAMC,KAAKL,MAAM5E,IAAI,K,oBAGtB,WACC,OAAO,U,iFANckF,aAgBRH,O,w8DCjBTI,E,wYACL,YAAwD,IAAhDvF,EAAgD,EAAhDA,KAAMwF,EAA0C,EAA1CA,MAA0C,IAAnCzF,aAAmC,MAA3B,GAA2B,EAApBiF,EAAoB,OACvD,OACC,sBAAMjF,MAAO,CAACyF,SAAQ/F,MAAO,kBAAoBM,GAAS,IAAMA,IAAYiF,GAC1EhF,Q,iFAJcsF,aAUTC,M,IAQKA","file":"route-editor.chunk.5edf3.js","sourcesContent":["import {h, FunctionComponent, Fragment} from \"preact\";\r\nimport {useContext, useState} from \"preact/hooks\";\r\nimport FileSystemContext from \"components/filesystem/context\";\r\nimport List from \"components/list\";\r\nimport Grid from \"components/grid\";\r\nimport {Tree} from \"utils/tree\";\r\nimport Icon from \"components/icon\";\r\nimport Redirect from \"utils/redirect\";\r\nimport \"./style.scss\";\r\n\r\nconst Editor: FunctionComponent<Editor.Props> = ({file}) => {\r\n\tconst fs = useContext(FileSystemContext);\r\n\tconst [zoom, setZoom] = useState(1);\r\n\tconst [map, setMap] = useState(true);\r\n\tconst editing = +file;\r\n\tif (!(editing in fs.all)) {\r\n\t\treturn <Redirect to=\"/\" />;\r\n\t}\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{h(map ? Grid : List, {editing, onZoomChange: setZoom, zoom})}\r\n\t\t\t<div class=\"vertical toolbar\">\r\n\t\t\t\t<button>\r\n\t\t\t\t\t<label>\r\n\t\t\t\t\t\t<input type=\"checkbox\" checked={map} onInput={e => setMap(e.currentTarget.checked)} />\r\n\t\t\t\t\t\t<Icon style=\"round\" name=\"\" />\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</button>\r\n\t\t\t\t<button\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tif (zoom > 0.25) {\r\n\t\t\t\t\t\t\tsetZoom(zoom - 0.25);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon name=\"zoom_out\" style=\"outlined\" />\r\n\t\t\t\t</button>\r\n\t\t\t\t<button\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tif (zoom <= 2.5) {\r\n\t\t\t\t\t\t\tsetZoom(zoom + 0.25);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon name=\"zoom_in\" style=\"outlined\" />\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"horizontal toolbar\">\r\n\t\t\t\t<button onClick={() => fs.undo()}>\r\n\t\t\t\t\t<Icon name=\"undo\" />\r\n\t\t\t\t</button>\r\n\t\t\t\t<button onClick={() => fs.redo()}>\r\n\t\t\t\t\t<Icon name=\"redo\" />\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n\r\n};\r\n\r\ndeclare namespace Editor {\r\n\texport interface Props {\r\n\t\tfile: `${number}`;\r\n\t}\r\n\r\n\texport interface State {\r\n\t\tundo: Tree.Data[];\r\n\t\tredo: Tree.Data[];\r\n\t\tzoom: number;\r\n\t\tview: string;\r\n\t}\r\n}\r\n\r\nexport default Editor;\r\n","/**\r\n * @author Tomáš Wróbel\r\n * @license MIT\r\n *\r\n * I am the component providing list view.\r\n * A list is fast to view and edit\r\n * but has nothing to do with maps\r\n */\r\nimport {h, FunctionComponent} from \"preact\";\r\nimport {useContext, useEffect, useRef} from \"preact/hooks\";\r\nimport FileSystemContext from \"../filesystem/context\";\r\nimport Icon from \"../icon\";\r\nimport \"./style.scss\";\r\nimport measure from \"utils/wrapText\";\r\nimport useMediaQuery from \"hooks/media_query\";\r\n\r\nconst focus: MutationCallback = (mutations) => {\r\n\tfor (const mutation of mutations) {\r\n\t\tconst input = mutation.addedNodes[0];\r\n\r\n\t\tif (input instanceof HTMLElement) {\r\n\t\t\tinput.querySelector(\"textarea\")?.focus?.();\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction prevent(event: Event) {\r\n\tevent.preventDefault();\r\n}\r\n\r\nconst observer = new MutationObserver(focus);\r\n\r\nconst List: FunctionComponent<List.Props> = ({editing, zoom = 1}) => {\r\n\tconst active = useRef<List.Item | null>(null);\r\n\tconst fs = useContext(FileSystemContext);\r\n\tconst container = useRef<HTMLDivElement>(null);\r\n\tconst phone = useMediaQuery(\"(max-width: 640px)\");\r\n\tconst tree = fs.all[editing];\r\n\r\n\tuseEffect(() => {\r\n\t\tobserver.observe(container.current!, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t});\r\n\r\n\t\treturn () => observer.disconnect();\r\n\t});\r\n\r\n\tconst previousLevel = (item: List.Item) => fs.change(\r\n\t\tediting,\r\n\t\t(key, value: List.Item) => {\r\n\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\tif (Array.isArray(value.children) && value.children.length && value.type !== \"heading\") {\r\n\t\t\t\t\tconst index = value.children.findIndex(nested => nested.children.indexOf(item) > -1) + 1;\r\n\t\t\t\t\tif (index) {\r\n\t\t\t\t\t\tconst returns = {\r\n\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\tchildren: value.children.map((nested, i) => {\r\n\t\t\t\t\t\t\t\tif (i === index - 1) {\r\n\t\t\t\t\t\t\t\t\treturn {...nested, children: nested.children.filter(i => i !== item)};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn nested;\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\treturns.children.splice(index, 0, item);\r\n\t\t\t\t\t\treturn returns;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tconst map = (item: List.Item, index: number, array: List.Item[]) => {\r\n\t\tconst {lines, width} = measure(item.text || \"New item...\", phone ? 17 : 20);\r\n\t\treturn (\r\n\t\t\t<li class={item.type}>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tstyle={{width}}\r\n\t\t\t\t\trows={lines.length}\r\n\t\t\t\t\tvalue={item.text}\r\n\t\t\t\t\tonFocus={() => active.current = item}\r\n\t\t\t\t\tonBlur={() => active.current = null}\r\n\t\t\t\t\ttabIndex={-1}\r\n\t\t\t\t\tonInput={e => fs.change(\r\n\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\tif (value === item) {\r\n\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\ttext: e.currentTarget.value,\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)}\r\n\t\t\t\t\tonKeyDown={e => {\r\n\t\t\t\t\t\tif (e.key === \"Enter\") {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\tif (!item.text) {\r\n\t\t\t\t\t\t\t\tpreviousLevel(item);\r\n\t\t\t\t\t\t\t} else if (e.ctrlKey) {\r\n\t\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\t\tif (value === item) {\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext:\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t`${item.text.slice(0, e.currentTarget.selectionStart)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\\n${item.text.slice(e.currentTarget.selectionEnd)}`,\r\n\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\te.currentTarget.selectionStart === e.currentTarget.selectionEnd &&\r\n\t\t\t\t\t\t\t\te.currentTarget.selectionStart === item.text.length\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tif (tree.children === array || item.children.length || e.shiftKey) {\r\n\t\t\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (value === item) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (item.type === \"note\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...item.children,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"note\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst returns = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...item.children\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturns.children.splice(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// The index of the first note.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If not present, insert the new body at the last position \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(item.children.findIndex(n => n.type === \"note\") + 1) || item.children.length,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"body\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn returns;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (value.children === array) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst returns = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [...array],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturns.children.splice(index + 1, 0, {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: e.shiftKey || item.type === \"note\" ? \"note\" : \"body\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn returns;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\te.currentTarget.selectionEnd = e.currentTarget.selectionStart = item.text.length;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (e.key === \"Backspace\" && !item.text) {\r\n\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\tif (value.children === array) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\t\t\t\tchildren: array.filter(a => a !== item),\r\n\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (e.key === \"Tab\" && index && array !== tree.children) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\tif (!e.shiftKey) {\r\n\t\t\t\t\t\t\t\tfs.change(\r\n\t\t\t\t\t\t\t\t\tediting,\r\n\t\t\t\t\t\t\t\t\t(key, value) => {\r\n\t\t\t\t\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\t\t\t\t\tif (value.children === array) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst returns = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [...array]\r\n\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\treturns.children.splice(index - 1, 2, {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...array[index - 1],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: array[index - 1].children.concat(item),\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn returns;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpreviousLevel(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tplaceholder=\"New item...\"\r\n\t\t\t\t/>\r\n\t\t\t\t{!item.children.length || <ul class={item.type}>{item.children.map(map)}</ul>}\r\n\t\t\t</li>\r\n\t\t);\r\n\t};\r\n\r\n\tconst add = (type: List.Item[\"type\"], index: number) => (e?: Event) => {\r\n\t\te?.preventDefault();\r\n\t\tconst isInside = (\r\n\t\t\tactive.current &&\r\n\t\t\ttree.children[index] === active.current ||\r\n\t\t\ttree.children[index].children.some(function some(i): boolean {\r\n\t\t\t\treturn i === active.current || i.children.some(some);\r\n\t\t\t})\r\n\t\t);\r\n\t\tif (isInside) {\r\n\t\t\tvar item = active.current!;\r\n\t\t} else {\r\n\t\t\tfor (\r\n\t\t\t\tvar item = tree.children[index];\r\n\t\t\t\titem.children.length;\r\n\t\t\t\titem = item.children[item.children.length - 1]\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst top = tree.children.includes(item) || !!item.children.length;\r\n\t\tfs.change(\r\n\t\t\tediting,\r\n\t\t\t(key, value) => {\r\n\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\tif (value === item && top) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\tchildren: [...item.children, {\r\n\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else if (!top && value.children?.includes(item)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t...value.children,\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div style={{zoom: `${zoom * 100}%`}} ref={container}>\r\n\t\t\t<h1>\r\n\t\t\t\t<input\r\n\t\t\t\t\tvalue={tree.text}\r\n\t\t\t\t\tonInput={e => fs.change(editing, (key, value) => {\r\n\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\tif (value === fs.all[editing]) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\ttext: e.currentTarget.value\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})}\r\n\t\t\t\t\tonKeyUp={e => e.key === \"Enter\" && fs.change(editing, (key, value) => {\r\n\t\t\t\t\t\tif (key !== \"width\" && key !== \"height\" && key !== \"x\" && key !== \"y\") {\r\n\t\t\t\t\t\t\tif (value === fs.all[editing]) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\t\t\t\tchildren: [...value.children, {\r\n\t\t\t\t\t\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\t\t\t\t\ttype: `color-${Math.floor(Math.random() * 36) + 1}`\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})}\r\n\t\t\t\t/>\r\n\t\t\t</h1>\r\n\t\t\t{fs.all[editing].children.map(map).map((tree, i) => (\r\n\t\t\t\t<ul class={`list ${tree.props.class}`} key={i}>\r\n\t\t\t\t\t{tree}\r\n\t\t\t\t\t<li class=\"add\" onMouseDown={prevent} onClick={add(\"body\", i)}>\r\n\t\t\t\t\t\t<Icon name=\"grid_view\" style=\"round\" role=\"button\" />\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li />\r\n\t\t\t\t\t<li class=\"add\" onMouseDown={prevent} onClick={add(\"note\", i)}>\r\n\t\t\t\t\t\t<Icon name=\"description\" style=\"round\" role=\"button\" />\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t))}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\ndeclare namespace List {\r\n\texport interface Props {\r\n\t\tzoom?: number;\r\n\t\tediting: number;\r\n\t\tonZoomChange?: (zoom: number) => void;\r\n\t}\r\n\r\n\texport interface Item {\r\n\t\ttext: string;\r\n\t\ttype: \"note\" | `color-${number}` | \"body\" | \"heading\";\r\n\t\tchildren: Item[];\r\n\t\tdescription?: string;\r\n\t\tlink?: string;\r\n\t}\r\n}\r\n\r\nexport default List;","import {useState, useEffect} from \"preact/hooks\";\r\n\r\nexport default function useMediaQuery(query: string) {\r\n\tconst [matches, setMatches] = useState(false);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst matchList = window.matchMedia(query);\r\n\t\tfunction change(e: MediaQueryListEvent) {\r\n\t\t\tsetMatches(e.matches);\r\n\t\t}\r\n\t\tmatchList.addEventListener(\"change\", change);\r\n\r\n\t\treturn () => {\r\n\t\t\tmatchList.removeEventListener(\"change\", change);\r\n\t\t}\r\n\t}, [query])\r\n\r\n\treturn matches;\r\n}","import {Component} from \"preact\";\r\nimport {route} from \"preact-router\";\r\n\r\nclass Redirect extends Component<Redirect.Props> {\r\n\tcomponentWillMount() {\r\n\t\troute(this.props.to, true);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\ndeclare namespace Redirect {\r\n\texport interface Props {\r\n\t\tto: string;\r\n\t}\r\n}\r\n\r\nexport default Redirect;","import {Component, h} from \"preact\";\r\n\r\nclass Icon extends Component<Icon.Props> {\r\n\trender({name, color, style = \"\", ...props}: Icon.Props) {\r\n\t\treturn (\r\n\t\t\t<span style={{color}} class={\"material-icons\" + (style && \"-\" + style)} {...props}>\r\n\t\t\t\t{name}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nnamespace Icon {\r\n\texport interface Props extends h.JSX.HTMLAttributes<HTMLSpanElement> {\r\n\t\tname: string;\r\n\t\tcolor?: string;\r\n\t\tstyle?: \"\" | \"round\" | \"outlined\";\r\n\t}\r\n}\r\n\r\nexport default Icon;\r\n"],"sourceRoot":""}